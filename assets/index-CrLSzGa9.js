import{r as en,a as x,u as Me,b as Ft,c as Ht,d as z,j as T,e as te,C as tn,E as nn,O as sn,f as rn}from"./react-three-vendor-B0ZqQ-7O.js";import{c as ce,g as F,a6 as on,Q as Fe,D as Ue,C as oe,a7 as V,a8 as an,a9 as st,aa as Gt,_ as cn,ab as Ee,Z as Ut,ac as Z,f as Bt,L as ee,ad as ln,ae as un,af as fn,ag as He,ah as dn,ai as hn,aj as Kt,u as pn,ak as mn,al as Be,am as gn,an as Vt,ao as Tn,ap as xn,aq as Rn,s as rt,ar as zt,as as ot,at as _n,w as yn,au as An,av as Ke,aw as En,ax as lt,G as Ae,ay as Mn,az as Sn,aA as bn,M as wn,aB as In,aC as Ln,aD as Cn,aE as Nn,aF as Ve,P as vn,O as On,aG as Pn,aH as Dn,aI as jn,aJ as kn,aK as Xt,aL as Fn,v as Tt,aM as xt,aN as Rt,aO as _t,i as yt,aP as Hn,aQ as Gn,aR as Yt,aS as Un,k as Bn}from"./three-vendor-BerUgOIx.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();var ze={exports:{}},Xe={};/**
 * @license React
 * react-compiler-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var At;function Kn(){if(At)return Xe;At=1;var f=en().__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;return Xe.c=function(e){return f.H.useMemoCache(e)},Xe}var Et;function Vn(){return Et||(Et=1,ze.exports=Kn()),ze.exports}var Q=Vn();const qt=.25,Ye=4*qt,qe=3*qt,zn=.65,Mt=.8,Xn=.04;function Yn({id:f,image:e,tablePosition:t,tableRotation:o,isActive:n,onToggle:r,children:s}){const a=x.useRef(null),{camera:i}=Me(),[c,u]=x.useState(!1);Ft(c||n,"pointer");const l=Ht(e),{gl:d}=Me();x.useEffect(()=>{l.colorSpace=ce,l.anisotropy=d.capabilities.getMaxAnisotropy(),l.needsUpdate=!0},[l,d]);const h=x.useMemo(()=>new F(...t),[t]),p=x.useMemo(()=>{const _=new on(...o);return new Fe().setFromEuler(_)},[o]);x.useEffect(()=>{const _=a.current;_&&(_.position.copy(h),_.quaternion.copy(p))},[h,p]),x.useEffect(()=>{n||u(!1)},[n]);const g=x.useMemo(()=>new F,[]),m=x.useMemo(()=>new Fe,[]),R=x.useMemo(()=>new F,[]),A=x.useMemo(()=>new F(0,-.05,0),[]);z((_,C)=>{const N=a.current;if(!N)return;const v=g,w=m;n?(v.copy(i.position),v.add(R.copy(i.getWorldDirection(R)).multiplyScalar(zn)),v.add(A),v.y<Mt&&(v.y=Mt),w.copy(i.quaternion)):(v.copy(h),c&&(v.y+=Xn),w.copy(p));const P=1-Math.exp(-C*12),S=1-Math.exp(-C*10);N.position.lerp(v,P),N.quaternion.slerp(w,S)});const M=x.useCallback(_=>{_.stopPropagation(),n||u(!0)},[n]),y=x.useCallback(_=>{_.stopPropagation(),u(!1)},[]),b=x.useCallback(_=>{_.stopPropagation()},[]),E=x.useCallback(_=>{_.stopPropagation(),r(f)},[f,r]);return T.jsx("group",{ref:a,children:T.jsxs("group",{rotation:[0,0,0],children:[T.jsxs("mesh",{onPointerOver:M,onPointerOut:y,onPointerDown:b,onClick:E,castShadow:!0,receiveShadow:!0,children:[T.jsx("planeGeometry",{args:[Ye,qe]}),T.jsx("meshStandardMaterial",{map:l,roughness:.35,metalness:.05,toneMapped:!1})]}),T.jsxs("mesh",{position:[0,0,-.001],rotation:[0,Math.PI,0],children:[T.jsx("planeGeometry",{args:[Ye,qe]}),T.jsx("meshStandardMaterial",{color:"#f7f2ff"})]}),T.jsxs("mesh",{position:[0,0,-8e-4],children:[T.jsx("planeGeometry",{args:[Ye*.98,qe*.98]}),T.jsx("meshStandardMaterial",{color:"#ffffff",side:Ue,roughness:1,metalness:0})]}),s]})})}const qn=100,Wn=10,J=qn*Wn,$n=-4,Zn=()=>{const f=Math.random();return new oe().setHSL(f,.65+Math.random()*.2,.6)};function Qn({isActive:f,origin:e=[0,5,-14]}){const t=x.useRef(null),o=x.useRef(null),n=x.useRef(null),r=x.useMemo(()=>new F(...e),[e]);n.current||(n.current={positions:new Float32Array(J*3),velocities:new Float32Array(J*3),origins:new Float32Array(J*3),baseColors:new Float32Array(J*3),colors:new Float32Array(J*3),ages:new Float32Array(J),lifetimes:new Float32Array(J)});const s=x.useCallback(a=>{const{positions:i,velocities:c,origins:u,baseColors:l,colors:d,ages:h,lifetimes:p}=n.current,g=a*3,m=r.clone().add(new F((Math.random()-.5)*1e3,Math.random()*200,(Math.random()-.5)*1e3));u[g]=m.x,u[g+1]=m.y,u[g+2]=m.z;const R=Math.random()*Math.PI*2,A=Math.acos(Math.random()*2-1)*.9,M=1+Math.random()*1.4;c[g]=Math.sin(A)*Math.cos(R)*M,c[g+1]=Math.cos(A)*(M*1.2),c[g+2]=Math.sin(A)*Math.sin(R)*M;const y=Zn();l[g]=y.r,l[g+1]=y.g,l[g+2]=y.b,d[g]=0,d[g+1]=0,d[g+2]=0,i[g]=m.x,i[g+1]=m.y,i[g+2]=m.z,p[a]=1.6+Math.random()*1.3,h[a]=-Math.random()*1.2},[r]);return x.useEffect(()=>{for(let a=0;a<J;a+=1)s(a)},[s]),z((a,i)=>{const c=t.current,u=o.current,l=n.current;if(!c||!u||!l)return;const{positions:d,velocities:h,origins:p,colors:g,baseColors:m,ages:R,lifetimes:A}=l,M=c.getAttribute("position"),y=c.getAttribute("color");if(!f){u.opacity=V.damp(u.opacity,0,5,i);return}u.opacity=V.damp(u.opacity,.85,2.5,i);for(let b=0;b<J;b+=1){const E=b*3;if(R[b]+=i,R[b]<0){d[E]=p[E],d[E+1]=p[E+1],d[E+2]=p[E+2],g[E]=0,g[E+1]=0,g[E+2]=0;continue}if(R[b]>A[b]||d[E+1]<r.y-1.5){s(b);continue}const _=R[b];d[E]=p[E]+h[E]*_,d[E+1]=p[E+1]+h[E+1]*_+.5*$n*_*_,d[E+2]=p[E+2]+h[E+2]*_;const C=Math.max(0,1-_/A[b]);g[E]=m[E]*C,g[E+1]=m[E+1]*C,g[E+2]=m[E+2]*C}M.needsUpdate=!0,y.needsUpdate=!0}),T.jsx("group",{children:T.jsxs("points",{frustumCulled:!1,children:[T.jsxs("bufferGeometry",{ref:t,children:[T.jsx("bufferAttribute",{attach:"attributes-position",args:[n.current.positions,3]}),T.jsx("bufferAttribute",{attach:"attributes-color",args:[n.current.colors,3]})]}),T.jsx("pointsMaterial",{ref:o,size:1,transparent:!0,vertexColors:!0,depthWrite:!1,opacity:0,sizeAttenuation:!0})]})})}function St(f,e){if(e===an)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),f;if(e===st||e===Gt){let t=f.getIndex();if(t===null){const s=[],a=f.getAttribute("position");if(a!==void 0){for(let i=0;i<a.count;i++)s.push(i);f.setIndex(s),t=f.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),f}const o=t.count-2,n=[];if(e===st)for(let s=1;s<=o;s++)n.push(t.getX(0)),n.push(t.getX(s)),n.push(t.getX(s+1));else for(let s=0;s<o;s++)s%2===0?(n.push(t.getX(s)),n.push(t.getX(s+1)),n.push(t.getX(s+2))):(n.push(t.getX(s+2)),n.push(t.getX(s+1)),n.push(t.getX(s)));n.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=f.clone();return r.setIndex(n),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),f}class ne extends cn{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new ss(t)}),this.register(function(t){return new rs(t)}),this.register(function(t){return new hs(t)}),this.register(function(t){return new ps(t)}),this.register(function(t){return new ms(t)}),this.register(function(t){return new is(t)}),this.register(function(t){return new as(t)}),this.register(function(t){return new cs(t)}),this.register(function(t){return new ls(t)}),this.register(function(t){return new ns(t)}),this.register(function(t){return new us(t)}),this.register(function(t){return new os(t)}),this.register(function(t){return new ds(t)}),this.register(function(t){return new fs(t)}),this.register(function(t){return new es(t)}),this.register(function(t){return new gs(t)}),this.register(function(t){return new Ts(t)})}load(e,t,o,n){const r=this;let s;if(this.resourcePath!=="")s=this.resourcePath;else if(this.path!==""){const c=Ee.extractUrlBase(e);s=Ee.resolveURL(c,this.path)}else s=Ee.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},i=new Ut(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,function(c){try{r.parse(c,s,function(u){t(u),r.manager.itemEnd(e)},a)}catch(u){a(u)}},o,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,o,n){let r;const s={},a={},i=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(i.decode(new Uint8Array(e,0,4))===Wt){try{s[L.KHR_BINARY_GLTF]=new xs(e)}catch(l){n&&n(l);return}r=JSON.parse(s[L.KHR_BINARY_GLTF].content)}else r=JSON.parse(i.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Ns(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const l=this.pluginCallbacks[u](c);l.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[l.name]=l,s[l.name]=!0}if(r.extensionsUsed)for(let u=0;u<r.extensionsUsed.length;++u){const l=r.extensionsUsed[u],d=r.extensionsRequired||[];switch(l){case L.KHR_MATERIALS_UNLIT:s[l]=new ts;break;case L.KHR_DRACO_MESH_COMPRESSION:s[l]=new Rs(r,this.dracoLoader);break;case L.KHR_TEXTURE_TRANSFORM:s[l]=new _s;break;case L.KHR_MESH_QUANTIZATION:s[l]=new ys;break;default:d.indexOf(l)>=0&&a[l]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}c.setExtensions(s),c.setPlugins(a),c.parse(o,n)}parseAsync(e,t){const o=this;return new Promise(function(n,r){o.parse(e,t,n,r)})}}function Jn(){let f={};return{get:function(e){return f[e]},add:function(e,t){f[e]=t},remove:function(e){delete f[e]},removeAll:function(){f={}}}}const L={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class es{constructor(e){this.parser=e,this.name=L.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let o=0,n=t.length;o<n;o++){const r=t[o];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,o="light:"+e;let n=t.cache.get(o);if(n)return n;const r=t.json,i=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const u=new oe(16777215);i.color!==void 0&&u.setRGB(i.color[0],i.color[1],i.color[2],ee);const l=i.range!==void 0?i.range:0;switch(i.type){case"directional":c=new fn(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new un(u),c.distance=l;break;case"spot":c=new ln(u),c.distance=l,i.spot=i.spot||{},i.spot.innerConeAngle=i.spot.innerConeAngle!==void 0?i.spot.innerConeAngle:0,i.spot.outerConeAngle=i.spot.outerConeAngle!==void 0?i.spot.outerConeAngle:Math.PI/4,c.angle=i.spot.outerConeAngle,c.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+i.type)}return c.position.set(0,0,0),$(c,i),i.intensity!==void 0&&(c.intensity=i.intensity),c.name=t.createUniqueName(i.name||"light_"+e),n=Promise.resolve(c),t.cache.add(o,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,o=this.parser,r=o.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(i){return o._getNodeRef(t.cache,a,i)})}}class ts{constructor(){this.name=L.KHR_MATERIALS_UNLIT}getMaterialType(){return Ae}extendParams(e,t,o){const n=[];e.color=new oe(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const s=r.baseColorFactor;e.color.setRGB(s[0],s[1],s[2],ee),e.opacity=s[3]}r.baseColorTexture!==void 0&&n.push(o.assignTexture(e,"map",r.baseColorTexture,ce))}return Promise.all(n)}}class ns{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class ss{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const o=this.parser,n=o.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&r.push(o.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&r.push(o.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(r.push(o.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const a=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Bt(a,a)}return Promise.all(r)}}class rs{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_DISPERSION}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class os{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const o=this.parser,n=o.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return s.iridescenceFactor!==void 0&&(t.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&r.push(o.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(t.iridescenceIOR=s.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&r.push(o.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class is{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_SHEEN}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const o=this.parser,n=o.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new oe(0,0,0),t.sheenRoughness=0,t.sheen=1;const s=n.extensions[this.name];if(s.sheenColorFactor!==void 0){const a=s.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],ee)}return s.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&r.push(o.assignTexture(t,"sheenColorMap",s.sheenColorTexture,ce)),s.sheenRoughnessTexture!==void 0&&r.push(o.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(r)}}class as{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const o=this.parser,n=o.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&r.push(o.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class cs{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_VOLUME}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const o=this.parser,n=o.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];t.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&r.push(o.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;const a=s.attenuationColor||[1,1,1];return t.attenuationColor=new oe().setRGB(a[0],a[1],a[2],ee),Promise.all(r)}}class ls{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_IOR}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class us{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_SPECULAR}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const o=this.parser,n=o.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];t.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&r.push(o.assignTexture(t,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return t.specularColor=new oe().setRGB(a[0],a[1],a[2],ee),s.specularColorTexture!==void 0&&r.push(o.assignTexture(t,"specularColorMap",s.specularColorTexture,ce)),Promise.all(r)}}class fs{constructor(e){this.parser=e,this.name=L.EXT_MATERIALS_BUMP}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const o=this.parser,n=o.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return t.bumpScale=s.bumpFactor!==void 0?s.bumpFactor:1,s.bumpTexture!==void 0&&r.push(o.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(r)}}class ds{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:Z}extendMaterialParams(e,t){const o=this.parser,n=o.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return s.anisotropyStrength!==void 0&&(t.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(t.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&r.push(o.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(r)}}class hs{constructor(e){this.parser=e,this.name=L.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,o=t.json,n=o.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,s)}}class ps{constructor(e){this.parser=e,this.name=L.EXT_TEXTURE_WEBP}loadTexture(e){const t=this.name,o=this.parser,n=o.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],a=n.images[s.source];let i=o.textureLoader;if(a.uri){const c=o.options.manager.getHandler(a.uri);c!==null&&(i=c)}return o.loadTextureImage(e,s.source,i)}}class ms{constructor(e){this.parser=e,this.name=L.EXT_TEXTURE_AVIF}loadTexture(e){const t=this.name,o=this.parser,n=o.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],a=n.images[s.source];let i=o.textureLoader;if(a.uri){const c=o.options.manager.getHandler(a.uri);c!==null&&(i=c)}return o.loadTextureImage(e,s.source,i)}}class gs{constructor(e){this.name=L.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,o=t.bufferViews[e];if(o.extensions&&o.extensions[this.name]){const n=o.extensions[this.name],r=this.parser.getDependency("buffer",n.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const i=n.byteOffset||0,c=n.byteLength||0,u=n.count,l=n.byteStride,d=new Uint8Array(a,i,c);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(u,l,d,n.mode,n.filter).then(function(h){return h.buffer}):s.ready.then(function(){const h=new ArrayBuffer(u*l);return s.decodeGltfBuffer(new Uint8Array(h),u,l,d,n.mode,n.filter),h})})}else return null}}class Ts{constructor(e){this.name=L.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,o=t.nodes[e];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;const n=t.meshes[o.mesh];for(const c of n.primitives)if(c.mode!==B.TRIANGLES&&c.mode!==B.TRIANGLE_STRIP&&c.mode!==B.TRIANGLE_FAN&&c.mode!==void 0)return null;const s=o.extensions[this.name].attributes,a=[],i={};for(const c in s)a.push(this.parser.getDependency("accessor",s[c]).then(u=>(i[c]=u,i[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),l=u.isGroup?u.children:[u],d=c[0].count,h=[];for(const p of l){const g=new He,m=new F,R=new Fe,A=new F(1,1,1),M=new dn(p.geometry,p.material,d);for(let y=0;y<d;y++)i.TRANSLATION&&m.fromBufferAttribute(i.TRANSLATION,y),i.ROTATION&&R.fromBufferAttribute(i.ROTATION,y),i.SCALE&&A.fromBufferAttribute(i.SCALE,y),M.setMatrixAt(y,g.compose(m,R,A));for(const y in i)if(y==="_COLOR_0"){const b=i[y];M.instanceColor=new hn(b.array,b.itemSize,b.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&p.geometry.setAttribute(y,i[y]);Kt.prototype.copy.call(M,p),this.parser.assignFinalMaterial(M),h.push(M)}return u.isGroup?(u.clear(),u.add(...h),u):h[0]}))}}const Wt="glTF",ye=12,bt={JSON:1313821514,BIN:5130562};class xs{constructor(e){this.name=L.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,ye),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Wt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-ye,r=new DataView(e,ye);let s=0;for(;s<n;){const a=r.getUint32(s,!0);s+=4;const i=r.getUint32(s,!0);if(s+=4,i===bt.JSON){const c=new Uint8Array(e,ye+s,a);this.content=o.decode(c)}else if(i===bt.BIN){const c=ye+s;this.body=e.slice(c,c+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Rs{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=L.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const o=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,a={},i={},c={};for(const u in s){const l=it[u]||u.toLowerCase();a[l]=s[u]}for(const u in e.attributes){const l=it[u]||u.toLowerCase();if(s[u]!==void 0){const d=o.accessors[e.attributes[u]],h=xe[d.componentType];c[l]=h.name,i[l]=d.normalized===!0}}return t.getDependency("bufferView",r).then(function(u){return new Promise(function(l,d){n.decodeDracoFile(u,function(h){for(const p in h.attributes){const g=h.attributes[p],m=i[p];m!==void 0&&(g.normalized=m)}l(h)},a,c,ee,d)})})}}class _s{constructor(){this.name=L.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class ys{constructor(){this.name=L.KHR_MESH_QUANTIZATION}}class $t extends Gn{constructor(e,t,o,n){super(e,t,o,n)}copySampleValue_(e){const t=this.resultBuffer,o=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let s=0;s!==n;s++)t[s]=o[r+s];return t}interpolate_(e,t,o,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,i=a*2,c=a*3,u=n-t,l=(o-t)/u,d=l*l,h=d*l,p=e*c,g=p-c,m=-2*h+3*d,R=h-d,A=1-m,M=R-d+l;for(let y=0;y!==a;y++){const b=s[g+y+a],E=s[g+y+i]*u,_=s[p+y+a],C=s[p+y]*u;r[y]=A*b+M*E+m*_+R*C}return r}}const As=new Fe;class Es extends $t{interpolate_(e,t,o,n){const r=super.interpolate_(e,t,o,n);return As.fromArray(r).normalize().toArray(r),r}}const B={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},xe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},wt={9728:zt,9729:rt,9984:Rn,9985:xn,9986:Tn,9987:Vt},It={33071:yn,33648:_n,10497:ot},We={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},it={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},re={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ms={CUBICSPLINE:void 0,LINEAR:Xt,STEP:kn},$e={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ss(f){return f.DefaultMaterial===void 0&&(f.DefaultMaterial=new lt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Hn})),f.DefaultMaterial}function ie(f,e,t){for(const o in t.extensions)f[o]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[o]=t.extensions[o])}function $(f,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(f.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function bs(f,e,t){let o=!1,n=!1,r=!1;for(let c=0,u=e.length;c<u;c++){const l=e[c];if(l.POSITION!==void 0&&(o=!0),l.NORMAL!==void 0&&(n=!0),l.COLOR_0!==void 0&&(r=!0),o&&n&&r)break}if(!o&&!n&&!r)return Promise.resolve(f);const s=[],a=[],i=[];for(let c=0,u=e.length;c<u;c++){const l=e[c];if(o){const d=l.POSITION!==void 0?t.getDependency("accessor",l.POSITION):f.attributes.position;s.push(d)}if(n){const d=l.NORMAL!==void 0?t.getDependency("accessor",l.NORMAL):f.attributes.normal;a.push(d)}if(r){const d=l.COLOR_0!==void 0?t.getDependency("accessor",l.COLOR_0):f.attributes.color;i.push(d)}}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(i)]).then(function(c){const u=c[0],l=c[1],d=c[2];return o&&(f.morphAttributes.position=u),n&&(f.morphAttributes.normal=l),r&&(f.morphAttributes.color=d),f.morphTargetsRelative=!0,f})}function ws(f,e){if(f.updateMorphTargets(),e.weights!==void 0)for(let t=0,o=e.weights.length;t<o;t++)f.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(f.morphTargetInfluences.length===t.length){f.morphTargetDictionary={};for(let o=0,n=t.length;o<n;o++)f.morphTargetDictionary[t[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Is(f){let e;const t=f.extensions&&f.extensions[L.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Ze(t.attributes):e=f.indices+":"+Ze(f.attributes)+":"+f.mode,f.targets!==void 0)for(let o=0,n=f.targets.length;o<n;o++)e+=":"+Ze(f.targets[o]);return e}function Ze(f){let e="";const t=Object.keys(f).sort();for(let o=0,n=t.length;o<n;o++)e+=t[o]+":"+f[t[o]]+";";return e}function at(f){switch(f){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ls(f){return f.search(/\.jpe?g($|\?)/i)>0||f.search(/^data\:image\/jpeg/)===0?"image/jpeg":f.search(/\.webp($|\?)/i)>0||f.search(/^data\:image\/webp/)===0?"image/webp":f.search(/\.ktx2($|\?)/i)>0||f.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Cs=new He;class Ns{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Jn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,n=-1,r=!1,s=-1;if(typeof navigator<"u"){const a=navigator.userAgent;o=/^((?!chrome|android).)*safari/i.test(a)===!0;const i=a.match(/Version\/(\d+)/);n=o&&i?parseInt(i[1],10):-1,r=a.indexOf("Firefox")>-1,s=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||o&&n<17||r&&s<98?this.textureLoader=new pn(this.options.manager):this.textureLoader=new mn(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ut(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const o=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(s){const a={scene:s[0][n.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:n.asset,parser:o,userData:{}};return ie(r,a,n),$(a,n),Promise.all(o._invokeAll(function(i){return i.afterRoot&&i.afterRoot(a)})).then(function(){for(const i of a.scenes)i.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],o=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const s=t[n].joints;for(let a=0,i=s.length;a<i;a++)e[s[a]].isBone=!0}for(let n=0,r=e.length;n<r;n++){const s=e[n];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(o[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,o){if(e.refs[t]<=1)return o;const n=o.clone(),r=(s,a)=>{const i=this.associations.get(s);i!=null&&this.associations.set(a,i);for(const[c,u]of s.children.entries())r(u,a.children[c])};return r(o,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let o=0;o<t.length;o++){const n=e(t[o]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const o=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&o.push(r)}return o}getDependency(e,t){const o=e+":"+t;let n=this.cache.get(o);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":n=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(o,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const o=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(r,s){return o.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],o=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[L.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(r,s){o.load(Ee.resolveURL(t.uri,n.path),r,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(o){const n=t.byteLength||0,r=t.byteOffset||0;return o.slice(r,r+n)})}loadAccessor(e){const t=this,o=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const s=We[n.type],a=xe[n.componentType],i=n.normalized===!0,c=new a(n.count*s);return Promise.resolve(new Be(c,s,i))}const r=[];return n.bufferView!==void 0?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),n.sparse!==void 0&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(s){const a=s[0],i=We[n.type],c=xe[n.componentType],u=c.BYTES_PER_ELEMENT,l=u*i,d=n.byteOffset||0,h=n.bufferView!==void 0?o.bufferViews[n.bufferView].byteStride:void 0,p=n.normalized===!0;let g,m;if(h&&h!==l){const R=Math.floor(d/h),A="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+R+":"+n.count;let M=t.cache.get(A);M||(g=new c(a,R*h,n.count*h/u),M=new gn(g,h/u),t.cache.add(A,M)),m=new Fn(M,i,d%h/u,p)}else a===null?g=new c(n.count*i):g=new c(a,d,n.count*i),m=new Be(g,i,p);if(n.sparse!==void 0){const R=We.SCALAR,A=xe[n.sparse.indices.componentType],M=n.sparse.indices.byteOffset||0,y=n.sparse.values.byteOffset||0,b=new A(s[1],M,n.sparse.count*R),E=new c(s[2],y,n.sparse.count*i);a!==null&&(m=new Be(m.array.slice(),m.itemSize,m.normalized)),m.normalized=!1;for(let _=0,C=b.length;_<C;_++){const N=b[_];if(m.setX(N,E[_*i]),i>=2&&m.setY(N,E[_*i+1]),i>=3&&m.setZ(N,E[_*i+2]),i>=4&&m.setW(N,E[_*i+3]),i>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}m.normalized=p}return m})}loadTexture(e){const t=this.json,o=this.options,r=t.textures[e].source,s=t.images[r];let a=this.textureLoader;if(s.uri){const i=o.manager.getHandler(s.uri);i!==null&&(a=i)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,o){const n=this,r=this.json,s=r.textures[e],a=r.images[t],i=(a.uri||a.bufferView)+":"+s.sampler;if(this.textureCache[i])return this.textureCache[i];const c=this.loadImageSource(t,o).then(function(u){u.flipY=!1,u.name=s.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const d=(r.samplers||{})[s.sampler]||{};return u.magFilter=wt[d.magFilter]||rt,u.minFilter=wt[d.minFilter]||Vt,u.wrapS=It[d.wrapS]||ot,u.wrapT=It[d.wrapT]||ot,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==zt&&u.minFilter!==rt,n.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[i]=c,c}loadImageSource(e,t){const o=this,n=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(l=>l.clone());const s=n.images[e],a=self.URL||self.webkitURL;let i=s.uri||"",c=!1;if(s.bufferView!==void 0)i=o.getDependency("bufferView",s.bufferView).then(function(l){c=!0;const d=new Blob([l],{type:s.mimeType});return i=a.createObjectURL(d),i});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(i).then(function(l){return new Promise(function(d,h){let p=d;t.isImageBitmapLoader===!0&&(p=function(g){const m=new Tt(g);m.needsUpdate=!0,d(m)}),t.load(Ee.resolveURL(l,r.path),p,void 0,h)})}).then(function(l){return c===!0&&a.revokeObjectURL(i),$(l,s),l.userData.mimeType=s.mimeType||Ls(s.uri),l}).catch(function(l){throw console.error("THREE.GLTFLoader: Couldn't load texture",i),l});return this.sourceCache[e]=u,u}assignTexture(e,t,o,n){const r=this;return this.getDependency("texture",o.index).then(function(s){if(!s)return null;if(o.texCoord!==void 0&&o.texCoord>0&&(s=s.clone(),s.channel=o.texCoord),r.extensions[L.KHR_TEXTURE_TRANSFORM]){const a=o.extensions!==void 0?o.extensions[L.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const i=r.associations.get(s);s=r.extensions[L.KHR_TEXTURE_TRANSFORM].extendTexture(s,a),r.associations.set(s,i)}}return n!==void 0&&(s.colorSpace=n),e[t]=s,s})}assignFinalMaterial(e){const t=e.geometry;let o=e.material;const n=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,s=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+o.uuid;let i=this.cache.get(a);i||(i=new An,Ke.prototype.copy.call(i,o),i.color.copy(o.color),i.map=o.map,i.sizeAttenuation=!1,this.cache.add(a,i)),o=i}else if(e.isLine){const a="LineBasicMaterial:"+o.uuid;let i=this.cache.get(a);i||(i=new En,Ke.prototype.copy.call(i,o),i.color.copy(o.color),i.map=o.map,this.cache.add(a,i)),o=i}if(n||r||s){let a="ClonedMaterial:"+o.uuid+":";n&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),s&&(a+="flat-shading:");let i=this.cache.get(a);i||(i=o.clone(),r&&(i.vertexColors=!0),s&&(i.flatShading=!0),n&&(i.normalScale&&(i.normalScale.y*=-1),i.clearcoatNormalScale&&(i.clearcoatNormalScale.y*=-1)),this.cache.add(a,i),this.associations.set(i,this.associations.get(o))),o=i}e.material=o}getMaterialType(){return lt}loadMaterial(e){const t=this,o=this.json,n=this.extensions,r=o.materials[e];let s;const a={},i=r.extensions||{},c=[];if(i[L.KHR_MATERIALS_UNLIT]){const l=n[L.KHR_MATERIALS_UNLIT];s=l.getMaterialType(),c.push(l.extendParams(a,r,t))}else{const l=r.pbrMetallicRoughness||{};if(a.color=new oe(1,1,1),a.opacity=1,Array.isArray(l.baseColorFactor)){const d=l.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],ee),a.opacity=d[3]}l.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",l.baseColorTexture,ce)),a.metalness=l.metallicFactor!==void 0?l.metallicFactor:1,a.roughness=l.roughnessFactor!==void 0?l.roughnessFactor:1,l.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",l.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",l.metallicRoughnessTexture))),s=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Ue);const u=r.alphaMode||$e.OPAQUE;if(u===$e.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===$e.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&s!==Ae&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Bt(1,1),r.normalTexture.scale!==void 0)){const l=r.normalTexture.scale;a.normalScale.set(l,l)}if(r.occlusionTexture!==void 0&&s!==Ae&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&s!==Ae){const l=r.emissiveFactor;a.emissive=new oe().setRGB(l[0],l[1],l[2],ee)}return r.emissiveTexture!==void 0&&s!==Ae&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,ce)),Promise.all(c).then(function(){const l=new s(a);return r.name&&(l.name=r.name),$(l,r),t.associations.set(l,{materials:e}),r.extensions&&ie(n,l,r),l})}createUniqueName(e){const t=Mn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,o=this.extensions,n=this.primitiveCache;function r(a){return o[L.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(i){return Lt(i,a,t)})}const s=[];for(let a=0,i=e.length;a<i;a++){const c=e[a],u=Is(c),l=n[u];if(l)s.push(l.promise);else{let d;c.extensions&&c.extensions[L.KHR_DRACO_MESH_COMPRESSION]?d=r(c):d=Lt(new Sn,c,t),n[u]={primitive:c,promise:d},s.push(d)}}return Promise.all(s)}loadMesh(e){const t=this,o=this.json,n=this.extensions,r=o.meshes[e],s=r.primitives,a=[];for(let i=0,c=s.length;i<c;i++){const u=s[i].material===void 0?Ss(this.cache):this.getDependency("material",s[i].material);a.push(u)}return a.push(t.loadGeometries(s)),Promise.all(a).then(function(i){const c=i.slice(0,i.length-1),u=i[i.length-1],l=[];for(let h=0,p=u.length;h<p;h++){const g=u[h],m=s[h];let R;const A=c[h];if(m.mode===B.TRIANGLES||m.mode===B.TRIANGLE_STRIP||m.mode===B.TRIANGLE_FAN||m.mode===void 0)R=r.isSkinnedMesh===!0?new bn(g,A):new wn(g,A),R.isSkinnedMesh===!0&&R.normalizeSkinWeights(),m.mode===B.TRIANGLE_STRIP?R.geometry=St(R.geometry,Gt):m.mode===B.TRIANGLE_FAN&&(R.geometry=St(R.geometry,st));else if(m.mode===B.LINES)R=new In(g,A);else if(m.mode===B.LINE_STRIP)R=new Ln(g,A);else if(m.mode===B.LINE_LOOP)R=new Cn(g,A);else if(m.mode===B.POINTS)R=new Nn(g,A);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(R.geometry.morphAttributes).length>0&&ws(R,r),R.name=t.createUniqueName(r.name||"mesh_"+e),$(R,r),m.extensions&&ie(n,R,m),t.assignFinalMaterial(R),l.push(R)}for(let h=0,p=l.length;h<p;h++)t.associations.set(l[h],{meshes:e,primitives:h});if(l.length===1)return r.extensions&&ie(n,l[0],r),l[0];const d=new Ve;r.extensions&&ie(n,d,r),t.associations.set(d,{meshes:e});for(let h=0,p=l.length;h<p;h++)d.add(l[h]);return d})}loadCamera(e){let t;const o=this.json.cameras[e],n=o[o.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?t=new vn(V.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):o.type==="orthographic"&&(t=new On(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),o.name&&(t.name=this.createUniqueName(o.name)),$(t,o),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],o=[];for(let n=0,r=t.joints.length;n<r;n++)o.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",t.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(n){const r=n.pop(),s=n,a=[],i=[];for(let c=0,u=s.length;c<u;c++){const l=s[c];if(l){a.push(l);const d=new He;r!==null&&d.fromArray(r.array,c*16),i.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Pn(a,i)})}loadAnimation(e){const t=this.json,o=this,n=t.animations[e],r=n.name?n.name:"animation_"+e,s=[],a=[],i=[],c=[],u=[];for(let l=0,d=n.channels.length;l<d;l++){const h=n.channels[l],p=n.samplers[h.sampler],g=h.target,m=g.node,R=n.parameters!==void 0?n.parameters[p.input]:p.input,A=n.parameters!==void 0?n.parameters[p.output]:p.output;g.node!==void 0&&(s.push(this.getDependency("node",m)),a.push(this.getDependency("accessor",R)),i.push(this.getDependency("accessor",A)),c.push(p),u.push(g))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(i),Promise.all(c),Promise.all(u)]).then(function(l){const d=l[0],h=l[1],p=l[2],g=l[3],m=l[4],R=[];for(let M=0,y=d.length;M<y;M++){const b=d[M],E=h[M],_=p[M],C=g[M],N=m[M];if(b===void 0)continue;b.updateMatrix&&b.updateMatrix();const v=o._createAnimationTracks(b,E,_,C,N);if(v)for(let w=0;w<v.length;w++)R.push(v[w])}const A=new Dn(r,void 0,R);return $(A,n),A})}createNodeMesh(e){const t=this.json,o=this,n=t.nodes[e];return n.mesh===void 0?null:o.getDependency("mesh",n.mesh).then(function(r){const s=o._getNodeRef(o.meshCache,n.mesh,r);return n.weights!==void 0&&s.traverse(function(a){if(a.isMesh)for(let i=0,c=n.weights.length;i<c;i++)a.morphTargetInfluences[i]=n.weights[i]}),s})}loadNode(e){const t=this.json,o=this,n=t.nodes[e],r=o._loadNodeShallow(e),s=[],a=n.children||[];for(let c=0,u=a.length;c<u;c++)s.push(o.getDependency("node",a[c]));const i=n.skin===void 0?Promise.resolve(null):o.getDependency("skin",n.skin);return Promise.all([r,Promise.all(s),i]).then(function(c){const u=c[0],l=c[1],d=c[2];d!==null&&u.traverse(function(h){h.isSkinnedMesh&&h.bind(d,Cs)});for(let h=0,p=l.length;h<p;h++)u.add(l[h]);return u})}_loadNodeShallow(e){const t=this.json,o=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],s=r.name?n.createUniqueName(r.name):"",a=[],i=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return i&&a.push(i),r.camera!==void 0&&a.push(n.getDependency("camera",r.camera).then(function(c){return n._getNodeRef(n.cameraCache,r.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(r.isBone===!0?u=new jn:c.length>1?u=new Ve:c.length===1?u=c[0]:u=new Kt,u!==c[0])for(let l=0,d=c.length;l<d;l++)u.add(c[l]);if(r.name&&(u.userData.name=r.name,u.name=s),$(u,r),r.extensions&&ie(o,u,r),r.matrix!==void 0){const l=new He;l.fromArray(r.matrix),u.applyMatrix4(l)}else r.translation!==void 0&&u.position.fromArray(r.translation),r.rotation!==void 0&&u.quaternion.fromArray(r.rotation),r.scale!==void 0&&u.scale.fromArray(r.scale);if(!n.associations.has(u))n.associations.set(u,{});else if(r.mesh!==void 0&&n.meshCache.refs[r.mesh]>1){const l=n.associations.get(u);n.associations.set(u,{...l})}return n.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,o=this.json.scenes[e],n=this,r=new Ve;o.name&&(r.name=n.createUniqueName(o.name)),$(r,o),o.extensions&&ie(t,r,o);const s=o.nodes||[],a=[];for(let i=0,c=s.length;i<c;i++)a.push(n.getDependency("node",s[i]));return Promise.all(a).then(function(i){for(let u=0,l=i.length;u<l;u++)r.add(i[u]);const c=u=>{const l=new Map;for(const[d,h]of n.associations)(d instanceof Ke||d instanceof Tt)&&l.set(d,h);return u.traverse(d=>{const h=n.associations.get(d);h!=null&&l.set(d,h)}),l};return n.associations=c(r),r})}_createAnimationTracks(e,t,o,n,r){const s=[],a=e.name?e.name:e.uuid,i=[];re[r.path]===re.weights?e.traverse(function(d){d.morphTargetInfluences&&i.push(d.name?d.name:d.uuid)}):i.push(a);let c;switch(re[r.path]){case re.weights:c=Rt;break;case re.rotation:c=_t;break;case re.translation:case re.scale:c=xt;break;default:switch(o.itemSize){case 1:c=Rt;break;case 2:case 3:default:c=xt;break}break}const u=n.interpolation!==void 0?Ms[n.interpolation]:Xt,l=this._getArrayFromAccessor(o);for(let d=0,h=i.length;d<h;d++){const p=new c(i[d]+"."+re[r.path],t.array,l,u);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),s.push(p)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const o=at(t.constructor),n=new Float32Array(t.length);for(let r=0,s=t.length;r<s;r++)n[r]=t[r]*o;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(o){const n=this instanceof _t?Es:$t;return new n(this.times,this.values,this.getValueSize()/3,o)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function vs(f,e,t){const o=e.attributes,n=new Yt;if(o.POSITION!==void 0){const a=t.json.accessors[o.POSITION],i=a.min,c=a.max;if(i!==void 0&&c!==void 0){if(n.set(new F(i[0],i[1],i[2]),new F(c[0],c[1],c[2])),a.normalized){const u=at(xe[a.componentType]);n.min.multiplyScalar(u),n.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new F,i=new F;for(let c=0,u=r.length;c<u;c++){const l=r[c];if(l.POSITION!==void 0){const d=t.json.accessors[l.POSITION],h=d.min,p=d.max;if(h!==void 0&&p!==void 0){if(i.setX(Math.max(Math.abs(h[0]),Math.abs(p[0]))),i.setY(Math.max(Math.abs(h[1]),Math.abs(p[1]))),i.setZ(Math.max(Math.abs(h[2]),Math.abs(p[2]))),d.normalized){const g=at(xe[d.componentType]);i.multiplyScalar(g)}a.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}f.boundingBox=n;const s=new Un;n.getCenter(s.center),s.radius=n.min.distanceTo(n.max)/2,f.boundingSphere=s}function Lt(f,e,t){const o=e.attributes,n=[];function r(s,a){return t.getDependency("accessor",s).then(function(i){f.setAttribute(a,i)})}for(const s in o){const a=it[s]||s.toLowerCase();a in f.attributes||n.push(r(o[s],a))}if(e.indices!==void 0&&!f.index){const s=t.getDependency("accessor",e.indices).then(function(a){f.setIndex(a)});n.push(s)}return yt.workingColorSpace!==ee&&"COLOR_0"in o&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${yt.workingColorSpace}" not supported.`),$(f,e),vs(f,e,t),Promise.all(n).then(function(){return e.targets!==void 0?bs(f,e.targets,t):f})}function Re(f){const e=Q.c(7),[t,o]=x.useState(!1);Ft(t);let n,r;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=c=>{c.stopPropagation(),o(!0)},r=()=>{o(!1)},e[0]=n,e[1]=r):(n=e[0],r=e[1]);let s;e[2]!==f?(s={onPointerOver:n,onPointerOut:r,onClick:c=>{c.stopPropagation(),f?.()}},e[2]=f,e[3]=s):s=e[3];const a=s;let i;return e[4]!==a||e[5]!==t?(i={hovered:t,bind:a},e[4]=a,e[5]=t,e[6]=i):i=e[6],i}const O=f=>{const e="/dy_23/",t=f.startsWith("/")?f.slice(1):f;return`${e.endsWith("/")?e:`${e}/`}${t}`};function Os(f){const e=Q.c(17);let t,o;e[0]!==f?({children:t,...o}=f,e[0]=f,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let n;e[3]===Symbol.for("react.memo_cache_sentinel")?(n=O("/cake.glb"),e[3]=n):n=e[3];const r=te(ne,n);let s;e[4]!==r.scene?(s=r.scene?.clone(!0)??null,e[4]=r.scene,e[5]=s):s=e[5];const a=s,i=x.useRef(null),[c,u]=x.useState(null);let l;e[6]===Symbol.for("react.memo_cache_sentinel")?(l=()=>{u(Date.now())},e[6]=l):l=e[6];const{hovered:d,bind:h}=Re(l);let p;if(e[7]!==d||e[8]!==c?(p=()=>{if(!i.current)return;const R=d?1.05:1,A=i.current.scale;if(A.x=V.lerp(A.x,R,.1),A.y=V.lerp(A.y,R,.1),A.z=V.lerp(A.z,R,.1),c!==null){const M=(Date.now()-c)/300;if(M>=1)u(null),i.current.scale.set(1,1,1);else{const y=Math.sin(M*Math.PI)*.2;i.current.scale.y=R-y,i.current.scale.x=R+y,i.current.scale.z=R+y}}},e[7]=d,e[8]=c,e[9]=p):p=e[9],z(p),!a)return null;let g;e[10]!==a?(g=T.jsx("group",{ref:i,children:T.jsx("primitive",{object:a})}),e[10]=a,e[11]=g):g=e[11];let m;return e[12]!==h||e[13]!==t||e[14]!==o||e[15]!==g?(m=T.jsxs("group",{...o,...h,children:[g,t]}),e[12]=h,e[13]=t,e[14]=o,e[15]=g,e[16]=m):m=e[16],m}function Ps(f){const e=Q.c(17);let t,o;e[0]!==f?({children:t,...o}=f,e[0]=f,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let n;e[3]===Symbol.for("react.memo_cache_sentinel")?(n=O("/cupcake.glb"),e[3]=n):n=e[3];const r=te(ne,n);let s;e[4]!==r.scene?(s=r.scene?.clone(!0)??null,e[4]=r.scene,e[5]=s):s=e[5];const a=s,i=x.useRef(null),[c,u]=x.useState(null);let l;e[6]===Symbol.for("react.memo_cache_sentinel")?(l=()=>{u(Date.now())},e[6]=l):l=e[6];const{hovered:d,bind:h}=Re(l);let p;if(e[7]!==d||e[8]!==c?(p=R=>{if(!i.current)return;const A=R.clock.elapsedTime,M=d?Math.sin(A*3)*.1+.1:0;let y=0;if(c!==null){const _=(Date.now()-c)/600;_>=1?u(null):y=4*_*(1-_)*.8}const b=i.current.position.y-(c?y:0),E=V.lerp(b,M,.1);i.current.position.y=E+y},e[7]=d,e[8]=c,e[9]=p):p=e[9],z(p),!a)return null;let g;e[10]!==a?(g=T.jsx("group",{ref:i,children:T.jsx("primitive",{object:a})}),e[10]=a,e[11]=g):g=e[11];let m;return e[12]!==h||e[13]!==t||e[14]!==o||e[15]!==g?(m=T.jsxs("group",{...o,...h,children:[g,t]}),e[12]=h,e[13]=t,e[14]=o,e[15]=g,e[16]=m):m=e[16],m}const Ds=`
  uniform float time;
  varying vec2 vUv;
  varying float hValue;

  float random (in vec2 st) {
      return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
  }

  float noise (in vec2 st) {
      vec2 i = floor(st);
      vec2 f = fract(st);
      float a = random(i);
      float b = random(i + vec2(1.0, 0.0));
      float c = random(i + vec2(0.0, 1.0));
      float d = random(i + vec2(1.0, 1.0));
      vec2 u = f*f*(3.0-2.0*f);
      return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
  }

  void main() {
    vUv = uv;
    vec3 pos = position;
    pos *= vec3(0.8, 2.0, 0.725);
    hValue = position.y;
    float posXZlen = length(position.xz);

    pos.y *= 1.0 + (cos((posXZlen + 0.25) * 3.1415926) * 0.4 + noise(vec2(0.0, time)) * 0.3 + noise(vec2(position.x + time, position.z + time)) * 0.8) * position.y;
    pos.x += noise(vec2(time * 2.0, (position.y - time) * 4.0)) * hValue * 0.15;
    pos.z += noise(vec2((position.y - time) * 4.0, time * 2.0)) * hValue * 0.15;
    pos.x += sin(time * 1.5 + position.y * 2.0) * hValue * 0.08;
    pos.z += cos(time * 1.3 + position.y * 2.0) * hValue * 0.08;

    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
  }
`,js=`
  uniform float strength;
  varying float hValue;
  varying vec2 vUv;

  vec3 heatmapGradient(float t) {
    return clamp(
      (pow(t, 1.5) * 0.8 + 0.2) *
        vec3(
          smoothstep(0.0, 0.35, t) + t * 0.5,
          smoothstep(0.5, 1.0, t),
          max(1.0 - t * 1.7, t * 7.0 - 6.0)
        ),
      0.0,
      1.0
    );
  }

  void main() {
    float v = abs(smoothstep(0.0, 0.4, hValue) - 1.0);
    float alpha = (1.0 - v) * 0.99;
    alpha -= 1.0 - smoothstep(1.0, 0.97, hValue);
    gl_FragColor = vec4(heatmapGradient(smoothstep(0.0, 0.3, hValue)) * vec3(0.95, 0.95, 0.4), alpha);
    gl_FragColor.rgb = mix(vec3(0.0, 0.0, 1.0), gl_FragColor.rgb, smoothstep(0.0, 0.3, hValue));
    gl_FragColor.rgb += vec3(1.0, 0.9, 0.5) * (1.25 - vUv.y);
    gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.66, 0.32, 0.03), smoothstep(0.95, 1.0, hValue));
    gl_FragColor *= strength;
  }
`;function ks({children:f,isLit:e=!0,...t}){const o=te(ne,O("/candle.glb")),n=x.useMemo(()=>o.scene?.clone(!0)??null,[o.scene]),r=x.useRef(null),s=x.useRef(null),a=x.useRef(e?1:0),i=x.useMemo(()=>({time:{value:0},strength:{value:1}}),[]),c=x.useMemo(()=>new Bn({uniforms:i,vertexShader:Ds,fragmentShader:js,transparent:!0,side:Ue}),[i]);return x.useEffect(()=>()=>{c.dispose()},[c]),x.useEffect(()=>{i.strength.value=e?1:0,a.current=e?1:0},[e,i]),z(({clock:u},l)=>{const d=u.elapsedTime;i.time.value=d;const h=e?1:0;i.strength.value=V.damp(i.strength.value,h,4,l);const p=r.current;if(!p)return;a.current=V.damp(a.current,h,4,l);const g=Math.sin(d*10)*.08+Math.sin(d*15.3)*.04+Math.sin(d*8.7)*.03,m=i.strength.value;p.intensity=Math.max(0,a.current+g*m*.5),p.position.y=3.5+Math.sin(d*5)*.1,p.position.x=Math.sin(d*3)*.05,p.position.z=Math.cos(d*2.7)*.05,p.visible=m>.02,s.current&&(s.current.visible=m>.02)}),n?T.jsxs("group",{...t,children:[T.jsx("primitive",{object:n}),T.jsx("mesh",{ref:s,scale:.4,position:[0,2.9,0],material:c,children:T.jsx("sphereGeometry",{args:[.5,32,32]})}),T.jsx("pointLight",{ref:r,distance:5,color:"#ffffffff",decay:1}),f]}):null}const Fs=[.82,.82];function je({image:f,imageScale:e=Fs,imageOffset:t,onImageClick:o,children:n,...r}){const{gl:s}=Me(),a=te(ne,O("/picture_frame.glb")),i=Ht(f);i.colorSpace=ce;const c=typeof s.capabilities.getMaxAnisotropy=="function"?s.capabilities.getMaxAnisotropy():1;i.anisotropy=c;const u=x.useMemo(()=>a.scene.clone(!0),[a.scene]),{frameSize:l,frameCenter:d}=x.useMemo(()=>{const P=new Yt().setFromObject(u),S=new F,j=new F;return P.getSize(S),P.getCenter(j),{frameSize:S,frameCenter:j}},[u]),h=x.useMemo(()=>Array.isArray(e)?e:[e,e],[e]),[p,g]=h,m=l.x*p,R=l.y*g,[A,M,y]=t??[0,.05,-.27],b=[d.x+A,d.y+M,d.z+y],E=x.useMemo(()=>new lt({map:i,roughness:.08,metalness:0,side:Ue}),[i]);x.useEffect(()=>()=>{E.dispose()},[E]);const _=x.useRef(null),[C,N]=x.useState(null),{hovered:v,bind:w}=Re(()=>{N(Date.now()),o?.(f)});return z(()=>{if(!_.current)return;const P=v?-.2:0;if(_.current.rotation.x=V.lerp(_.current.rotation.x,P,.1),C!==null){const j=(Date.now()-C)/400;j>=1?(N(null),_.current.rotation.z=0):_.current.rotation.z=Math.sin(j*Math.PI*4)*.1}}),T.jsx("group",{...r,...w,children:T.jsx("group",{ref:_,children:T.jsxs("group",{rotation:[.04,0,0],children:[T.jsx("primitive",{object:u}),T.jsx("mesh",{position:b,rotation:[.435,Math.PI,0],material:E,children:T.jsx("planeGeometry",{args:[m,R]})}),n]})})})}function Hs(f){const e=Q.c(12);let t,o;e[0]!==f?({children:t,...o}=f,e[0]=f,e[1]=t,e[2]=o):(t=e[1],o=e[2]);let n;e[3]===Symbol.for("react.memo_cache_sentinel")?(n=O("/table.glb"),e[3]=n):n=e[3];const r=te(ne,n);let s;e[4]!==r.scene?(s=r.scene?.clone(!0)??null,e[4]=r.scene,e[5]=s):s=e[5];const a=s;if(!a)return null;let i;e[6]!==a?(i=T.jsx("primitive",{object:a}),e[6]=a,e[7]=i):i=e[7];let c;return e[8]!==t||e[9]!==o||e[10]!==i?(c=T.jsxs("group",{...o,children:[i,t]}),e[8]=t,e[9]=o,e[10]=i,e[11]=c):c=e[11],c}const Gs=100,Us=-5.5,ge=4,Qe=50;function Bs(f){const e=Q.c(29);let t,o,n,r;e[0]!==f?({isActive:o,origin:n,intensity:r,...t}=f,e[0]=f,e[1]=t,e[2]=o,e[3]=n,e[4]=r):(t=e[1],o=e[2],n=e[3],r=e[4]);const s=o===void 0?!1:o;let a;e[5]!==n?(a=n===void 0?[0,3,0]:n,e[5]=n,e[6]=a):a=e[6];const i=a,c=r===void 0?.8:r;let u;e[7]===Symbol.for("react.memo_cache_sentinel")?(u=O("/confetti.glb"),e[7]=u):u=e[7];const l=te(ne,u),d=x.useRef(null);let h;e[8]===Symbol.for("react.memo_cache_sentinel")?(h=[],e[8]=h):h=e[8];const p=x.useRef(h),g=x.useRef(!1),m=Math.floor(Gs*c);let R,A;e[9]!==i||e[10]!==m?(R=()=>{p.current=Array.from({length:m},()=>({position:[i[0],i[1],i[2]],velocity:[(Math.random()-.5)*ge,Math.random()*ge+2,(Math.random()-.5)*ge],rotation:[Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2],rotationSpeed:[(Math.random()-.5)*10,(Math.random()-.5)*10,(Math.random()-.5)*10],lifespan:0,maxLifespan:3+Math.random()*1.5}))},A=[m,i],e[9]=i,e[10]=m,e[11]=R,e[12]=A):(R=e[11],A=e[12]),x.useEffect(R,A);let M,y;e[13]!==s||e[14]!==i?(y=()=>{s&&!g.current?(g.current=!0,p.current=p.current.map(()=>({position:[i[0]+(Math.random()-.5)*Qe,i[1]+(Math.random()-.5)*Qe,i[2]+(Math.random()-.5)*Qe],velocity:[(Math.random()-.5)*ge,Math.random()*ge+2,(Math.random()-.5)*ge],rotation:[Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2],rotationSpeed:[(Math.random()-.5)*10,(Math.random()-.5)*10,(Math.random()-.5)*10],lifespan:0,maxLifespan:3+Math.random()*1.5}))):s||(g.current=!1)},M=[s,i],e[13]=s,e[14]=i,e[15]=M,e[16]=y):(M=e[15],y=e[16]),x.useEffect(y,M);let b;e:{if(!l.scene){let w;e[17]===Symbol.for("react.memo_cache_sentinel")?(w=[],e[17]=w):w=e[17],b=w;break e}let v;if(e[18]!==l.scene||e[19]!==m){let w;e[21]!==l.scene?(w=(P,S)=>{const j=l.scene.clone(!0);return j.scale.set(.35,.35,.35),{key:S,scene:j}},e[21]=l.scene,e[22]=w):w=e[22],v=Array.from({length:m},w),e[18]=l.scene,e[19]=m,e[20]=v}else v=e[20];b=v}const E=b;let _;e[23]===Symbol.for("react.memo_cache_sentinel")?(_=(v,w)=>{if(!d.current||!g.current)return;const P=d.current.children;p.current.forEach((S,j)=>{if(j>=P.length)return;const H=P[j];if(S.lifespan=S.lifespan+w,S.lifespan<S.maxLifespan){S.velocity[1]=S.velocity[1]+Us*w,S.position[0]=S.position[0]+S.velocity[0]*w,S.position[1]=S.position[1]+S.velocity[1]*w,S.position[2]=S.position[2]+S.velocity[2]*w,S.rotation[0]=S.rotation[0]+S.rotationSpeed[0]*w,S.rotation[1]=S.rotation[1]+S.rotationSpeed[1]*w,S.rotation[2]=S.rotation[2]+S.rotationSpeed[2]*w,H.position.set(...S.position),H.rotation.set(...S.rotation);const X=S.lifespan/S.maxLifespan,Y=Math.max(0,1-X);H.visible=Y>.01,H.traverse(G=>{G.isMesh&&G.material&&(Array.isArray(G.material)?G.material.forEach(I=>{I.transparent=!0,I.opacity=Y}):(G.material.transparent=!0,G.material.opacity=Y))})}else H.visible=!1})},e[23]=_):_=e[23],z(_);let C;e[24]!==E?(C=E.map(Ks),e[24]=E,e[25]=C):C=e[25];let N;return e[26]!==t||e[27]!==C?(N=T.jsx("group",{ref:d,...t,children:C}),e[26]=t,e[27]=C,e[28]=N):N=e[28],N}function Ks(f){const{key:e,scene:t}=f;return T.jsx("primitive",{object:t},e)}const ut={audio:{file:O("/music.mp3")},assets:{cakeModel:O("/cake.glb"),candleModel:O("/candle.glb"),flowerModel:O("/flowers.glb"),flowerModel2:O("/flowers2.glb"),teddyModel:O("/teddy.glb"),hdrBackground:O("/shanghai_bund_4k.hdr")},pictureFrames:[{image:O("/frame2.jpg"),position:[0,.735,3],rotation:[0,5.6,0]},{image:O("/frame3.jpg"),position:[0,.735,-3],rotation:[0,4,0]},{image:O("/frame4.jpg"),position:[-1.5,.735,2.5],rotation:[0,5.4,0]},{image:O("/frame1.jpg"),position:[-1.5,.735,-2.5],rotation:[0,4.2,0]}],cards:[{id:"confetti",image:O("/card.png"),position:[1,.081,-2],rotation:[-Math.PI/2,0,Math.PI/3]}]};function Vs(f){const e=Q.c(14);let t,o;e[0]!==f?({children:t,...o}=f,e[0]=f,e[1]=t,e[2]=o):(t=e[1],o=e[2]);const n=te(ne,ut.assets.flowerModel);let r;e[3]!==n.scene?(r=n.scene?.clone(!0)??null,e[3]=n.scene,e[4]=r):r=e[4];const s=r,a=x.useRef(null),{hovered:i,bind:c}=Re();let u;if(e[5]!==i?(u=h=>{if(!a.current)return;const p=h.clock.elapsedTime,g=i?5:2,m=i?.1:.02;a.current.rotation.z=Math.sin(p*g)*m,a.current.rotation.x=Math.cos(p*g*.7)*m*.5},e[5]=i,e[6]=u):u=e[6],z(u),!s)return null;let l;e[7]!==s?(l=T.jsx("group",{ref:a,children:T.jsx("primitive",{object:s})}),e[7]=s,e[8]=l):l=e[8];let d;return e[9]!==c||e[10]!==t||e[11]!==o||e[12]!==l?(d=T.jsxs("group",{...o,...c,children:[l,t]}),e[9]=c,e[10]=t,e[11]=o,e[12]=l,e[13]=d):d=e[13],d}function zs(f){const e=Q.c(14);let t,o;e[0]!==f?({children:t,...o}=f,e[0]=f,e[1]=t,e[2]=o):(t=e[1],o=e[2]);const n=te(ne,ut.assets.flowerModel2);let r;e[3]!==n.scene?(r=n.scene?.clone(!0)??null,e[3]=n.scene,e[4]=r):r=e[4];const s=r,a=x.useRef(null),{hovered:i,bind:c}=Re();let u;if(e[5]!==i?(u=h=>{if(!a.current)return;const p=h.clock.elapsedTime,g=i?5:2,m=i?.1:.02;a.current.rotation.z=Math.sin(p*g)*m,a.current.rotation.x=Math.cos(p*g*.7)*m*.5},e[5]=i,e[6]=u):u=e[6],z(u),!s)return null;let l;e[7]!==s?(l=T.jsx("group",{ref:a,children:T.jsx("primitive",{object:s})}),e[7]=s,e[8]=l):l=e[8];let d;return e[9]!==c||e[10]!==t||e[11]!==o||e[12]!==l?(d=T.jsxs("group",{...o,...c,children:[l,t]}),e[9]=c,e[10]=t,e[11]=o,e[12]=l,e[13]=d):d=e[13],d}function Xs(f){const e=Q.c(16);let t,o;e[0]!==f?({children:t,...o}=f,e[0]=f,e[1]=t,e[2]=o):(t=e[1],o=e[2]);const n=te(ne,ut.assets.teddyModel);let r;e[3]!==n.scene?(r=n.scene?.clone(!0)??null,e[3]=n.scene,e[4]=r):r=e[4];const s=r,a=x.useRef(null),[i,c]=x.useState(null);let u;e[5]===Symbol.for("react.memo_cache_sentinel")?(u=()=>{c(Date.now())},e[5]=u):u=e[5];const{hovered:l,bind:d}=Re(u);let h;if(e[6]!==l||e[7]!==i?(h=m=>{if(!a.current)return;const R=m.clock.elapsedTime,A=l?Math.sin(R*4)*.15:0;if(a.current.rotation.y=V.lerp(a.current.rotation.y,A,.1),i!==null){const M=(Date.now()-i)/500;M>=1?(c(null),a.current.position.y=0):a.current.position.y=4*M*(1-M)*.5}},e[6]=l,e[7]=i,e[8]=h):h=e[8],z(h),!s)return null;let p;e[9]!==s?(p=T.jsx("group",{ref:a,children:T.jsx("primitive",{object:s})}),e[9]=s,e[10]=p):p=e[10];let g;return e[11]!==d||e[12]!==t||e[13]!==o||e[14]!==p?(g=T.jsxs("group",{...o,...d,children:[p,t]}),e[11]=d,e[12]=t,e[13]=o,e[14]=p,e[15]=g):g=e[15],g}const ae=(f,e,t)=>Math.min(t,Math.max(e,f)),Je=(f,e,t)=>f+(e-f)*t,ke=f=>1-Math.pow(1-f,3),Ct=10,Nt=0,ft=3,et=30,vt=0,dt=.7,ct=ft-dt-.1,tt=5,Ot=0,Zt=1.2,Ge=Math.max(ft,ct+dt)+1,Pt=Ge+Zt,nt=new F(0,1,0),Dt=4.2,Ys=1,jt=Math.PI/2,qs=2,Ws=6,$s=Math.PI*0,Zs=Math.PI/2,ht=1,Qs=0,Js=Math.max(Ge-Qs,ht),kt=Math.max(Js-ht,0),Te=[" > hai dydy sayang... (////)"," ... "," > happy birthday, my cutee babyy "," ... "," > aku buat kue ala-ala digital buat kamuu ehehehe"," ... "," > make a wish... ()*:"],er=85,tr=1e3,nr=450,sr=[{id:"confetti",image:O("/card.png"),position:[2.5,.15,0],rotation:[-Math.PI/2,.1,Math.PI/2]}];function rr(f){const e=Q.c(58),{isPlaying:t,onBackgroundFadeChange:o,onEnvironmentProgressChange:n,candleLit:r,onAnimationComplete:s,cards:a,activeCardId:i,onToggleCard:c,onPreviewImage:u}=f,l=x.useRef(null),d=x.useRef(null),h=x.useRef(null),p=x.useRef(null),g=x.useRef(!1),m=x.useRef(!1),R=x.useRef(!1),A=x.useRef(1),M=x.useRef(0);let y,b;e[0]!==o||e[1]!==n?(y=()=>{o?.(A.current),n?.(M.current)},b=[o,n],e[0]=o,e[1]=n,e[2]=y,e[3]=b):(y=e[2],b=e[3]),x.useEffect(y,b);let E;e[4]!==o?(E=q=>{const k=ae(q,0,1);Math.abs(k-A.current)>.005&&(A.current=k,o?.(k))},e[4]=o,e[5]=E):E=e[5];const _=E;let C;e[6]!==n?(C=q=>{const k=ae(q,0,1);Math.abs(k-M.current)>.005&&(M.current=k,n?.(k))},e[6]=n,e[7]=C):C=e[7];const N=C;let v;e[8]!==_||e[9]!==N||e[10]!==t||e[11]!==s?(v=q=>{const{clock:k}=q,K=l.current,me=d.current,W=h.current;if(!K||!me||!W)return;if(g.current||(K.position.set(0,Ct,0),K.rotation.set(0,0,0),me.position.set(0,0,et),me.rotation.set(0,0,0),W.position.set(0,tt,0),W.visible=!1,g.current=!0),!t){_(1),N(0),p.current=null,m.current=!1,R.current=!1;return}if(m.current){_(0),N(1),R.current||(R.current=!0,s?.());return}p.current===null&&(p.current=k.elapsedTime);const Qt=k.elapsedTime-p.current,se=ae(Qt,0,Pt),Jt=ae(se/ft,0,1),pt=ke(Jt);K.position.y=Je(Ct,Nt,pt),K.position.x=0,K.position.z=0,K.rotation.y=pt*Math.PI*2,K.rotation.x=0,K.rotation.z=0;let mt=et;if(se>=ct){const _e=ae((se-ct)/dt,0,1),De=ke(_e);mt=Je(et,vt,De)}if(me.position.set(0,0,mt),me.rotation.set(0,0,0),se>=Ge){W.visible||(W.visible=!0);const _e=ae((se-Ge)/Zt,0,1),De=ke(_e);W.position.y=Je(tt,Ot,De)}else W.visible=!1,W.position.set(0,tt,0);if(se<kt)_(1),N(0);else{const _e=ae((se-kt)/ht,0,1),gt=1-ke(_e);_(gt),N(1-gt)}se>=Pt&&(K.position.set(0,Nt,0),K.rotation.set(0,0,0),me.position.set(0,0,vt),W.position.set(0,Ot,0),W.visible=!0,_(0),N(1),m.current=!0,R.current||(R.current=!0,s?.()))},e[8]=_,e[9]=N,e[10]=t,e[11]=s,e[12]=v):v=e[12],z(v);let w;e[13]===Symbol.for("react.memo_cache_sentinel")?(w=T.jsx(Hs,{}),e[13]=w):w=e[13];let P,S,j;e[14]===Symbol.for("react.memo_cache_sentinel")?(P=O("/frame2.jpg"),S=[0,.735,3],j=[0,5.6,0],e[14]=P,e[15]=S,e[16]=j):(P=e[14],S=e[15],j=e[16]);let H;e[17]!==u?(H=T.jsx(je,{image:P,position:S,rotation:j,scale:.75,onImageClick:u}),e[17]=u,e[18]=H):H=e[18];let X,Y,G;e[19]===Symbol.for("react.memo_cache_sentinel")?(X=O("/frame3.jpg"),Y=[0,.735,-3],G=[0,4,0],e[19]=X,e[20]=Y,e[21]=G):(X=e[19],Y=e[20],G=e[21]);let I;e[22]!==u?(I=T.jsx(je,{image:X,position:Y,rotation:G,scale:.75,onImageClick:u}),e[22]=u,e[23]=I):I=e[23];let D,U,le;e[24]===Symbol.for("react.memo_cache_sentinel")?(D=O("/frame4.jpg"),U=[-1.5,.735,2.5],le=[0,5.4,0],e[24]=D,e[25]=U,e[26]=le):(D=e[24],U=e[25],le=e[26]);let ue;e[27]!==u?(ue=T.jsx(je,{image:D,position:U,rotation:le,scale:.75,onImageClick:u}),e[27]=u,e[28]=ue):ue=e[28];let Se,be,we;e[29]===Symbol.for("react.memo_cache_sentinel")?(Se=O("/frame1.jpg"),be=[-1.5,.735,-2.5],we=[0,4.2,0],e[29]=Se,e[30]=be,e[31]=we):(Se=e[29],be=e[30],we=e[31]);let fe;e[32]!==u?(fe=T.jsx(je,{image:Se,position:be,rotation:we,scale:.75,onImageClick:u}),e[32]=u,e[33]=fe):fe=e[33];let Ie;e[34]===Symbol.for("react.memo_cache_sentinel")?(Ie=T.jsx(Vs,{scale:.04,position:[2.2,.62,3],rotation:[0,0,0]}),e[34]=Ie):Ie=e[34];let Le;e[35]===Symbol.for("react.memo_cache_sentinel")?(Le=T.jsx(zs,{scale:2.5,position:[2.2,.5,2],rotation:[-1,.1,0]}),e[35]=Le):Le=e[35];let Ce;e[36]===Symbol.for("react.memo_cache_sentinel")?(Ce=T.jsx(Xs,{scale:6.5,position:[-3,.99,0],rotation:[0,Math.PI/2,0]}),e[36]=Ce):Ce=e[36];let Ne;e[37]===Symbol.for("react.memo_cache_sentinel")?(Ne=T.jsx(Ps,{scale:4,position:[1.5,.45,-3],rotation:[0,Math.PI/5,0]}),e[37]=Ne):Ne=e[37];let de;if(e[38]!==i||e[39]!==a||e[40]!==c){let q;e[42]!==i||e[43]!==c?(q=k=>T.jsx(Yn,{id:k.id,image:k.image,tablePosition:k.position,tableRotation:k.rotation,isActive:i===k.id,onToggle:c},k.id),e[42]=i,e[43]=c,e[44]=q):q=e[44],de=a.map(q),e[38]=i,e[39]=a,e[40]=c,e[41]=de}else de=e[41];let he;e[45]!==H||e[46]!==I||e[47]!==ue||e[48]!==fe||e[49]!==de?(he=T.jsxs("group",{ref:d,children:[w,H,I,ue,fe,Ie,Le,Ce,Ne,de]}),e[45]=H,e[46]=I,e[47]=ue,e[48]=fe,e[49]=de,e[50]=he):he=e[50];let ve;e[51]===Symbol.for("react.memo_cache_sentinel")?(ve=T.jsx("group",{ref:l,children:T.jsx(Os,{})}),e[51]=ve):ve=e[51];let Oe;e[52]===Symbol.for("react.memo_cache_sentinel")?(Oe=[0,1.1,0],e[52]=Oe):Oe=e[52];let pe;e[53]!==r?(pe=T.jsx("group",{ref:h,children:T.jsx(ks,{isLit:r,scale:.25,position:Oe})}),e[53]=r,e[54]=pe):pe=e[54];let Pe;return e[55]!==he||e[56]!==pe?(Pe=T.jsxs(T.Fragment,{children:[he,ve,pe]}),e[55]=he,e[56]=pe,e[57]=Pe):Pe=e[57],Pe}function or(){const f=Q.c(4),e=x.useRef(null),t=Me(ir);let o,n;f[0]!==t?(o=()=>{const s=new F(Math.sin(jt)*Dt,Ys,Math.cos(jt)*Dt),a=nt.clone().add(s);t.position.copy(a),t.lookAt(nt);const i=e.current;i&&(i.target.copy(nt),i.update())},n=[t],f[0]=t,f[1]=o,f[2]=n):(o=f[1],n=f[2]),x.useEffect(o,n);let r;return f[3]===Symbol.for("react.memo_cache_sentinel")?(r=T.jsx(sn,{ref:e,enableDamping:!0,dampingFactor:.05,minDistance:qs,maxDistance:Ws,minPolarAngle:$s,maxPolarAngle:Zs}),f[3]=r):r=f[3],r}function ir(f){return f.camera}function ar({intensity:f}){const e=Me(t=>t.scene);return x.useEffect(()=>{"backgroundIntensity"in e&&(e.backgroundIntensity=f)},[e,f]),null}function cr(){const[f,e]=x.useState(!1),[t,o]=x.useState(1),[n,r]=x.useState(0),[s,a]=x.useState(0),[i,c]=x.useState(0),[u,l]=x.useState(!0),[d,h]=x.useState(!1),[p,g]=x.useState(!1),[m,R]=x.useState(!0),[A,M]=x.useState(!1),[y,b]=x.useState(!1),[E,_]=x.useState(null),[C,N]=x.useState(null),v=x.useRef(null);x.useEffect(()=>{const I=new Audio(O("/music.mp3"));return I.loop=!0,I.preload="auto",v.current=I,()=>{I.pause(),v.current=null}},[]);const w=x.useCallback(()=>{const I=v.current;!I||!I.paused||(I.currentTime=0,I.play().catch(()=>{}))},[]),P=s>=Te.length,S=x.useMemo(()=>Te.length===0?[""]:Te.map((I,D)=>P||D<s?I:D===s?I.slice(0,Math.min(i,I.length)):""),[i,s,P]),j=P?Math.max(S.length-1,0):s,H=Math.max(Math.min(j,S.length-1),0);x.useEffect(()=>{if(!f){a(0),c(0),h(!1),R(!0),M(!1),g(!1);return}if(P){if(!d){const U=window.setTimeout(()=>{h(!0)},tr);return()=>window.clearTimeout(U)}return}const I=Te[s]??"",D=window.setTimeout(()=>{if(i<I.length){c(le=>le+1);return}let U=s+1;for(;U<Te.length&&Te[U].length===0;)U+=1;a(U),c(0)},er);return()=>window.clearTimeout(D)},[f,i,s,P,d]),x.useEffect(()=>{const I=window.setInterval(()=>{l(D=>!D)},nr);return()=>window.clearInterval(I)},[]);const X=x.useCallback(()=>{f||(w(),e(!0))},[f,w]);x.useEffect(()=>{const I=D=>{if(!(D.code!=="Space"&&D.key!==" ")){if(D.preventDefault(),!f){X();return}p&&m&&R(!1)}};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[f,p,m,w,X]);const Y=x.useCallback(I=>{_(D=>D===I?null:I)},[]),G=f&&d;return T.jsxs("div",{className:"App",children:[T.jsx("div",{className:"background-overlay",style:{opacity:t},children:T.jsx("div",{className:"typed-text",children:S.map((I,D)=>{const U=u&&D===H&&(!P||!d);return T.jsxs("span",{className:"typed-line",children:[I||"",U&&T.jsx("span",{"aria-hidden":"true",className:"typed-cursor"})]},`typed-line-${D}`)})})}),!f&&T.jsxs("div",{className:"start-overlay",children:[T.jsx("div",{className:"start-title",children:" A Special Gift For You "}),T.jsx("button",{className:"action-button",onClick:X,children:" Tap to Start "})]}),p&&m&&E===null&&T.jsxs("div",{className:"blow-candle-container",children:[T.jsx("span",{className:"blow-candle-hint",children:"make a wish and..."}),T.jsx("button",{className:"action-button blow-button",onClick:()=>{R(!1),b(!0)},children:" Blow the Candle "})]}),T.jsx(tn,{gl:{alpha:!0},style:{background:"transparent"},onCreated:({gl:I})=>{I.setClearColor("#000000",0)},children:T.jsxs(x.Suspense,{fallback:null,children:[T.jsx(rr,{isPlaying:G,candleLit:m,onBackgroundFadeChange:o,onEnvironmentProgressChange:r,onAnimationComplete:()=>{g(!0),M(!0)},cards:sr,activeCardId:E,onToggleCard:Y,onPreviewImage:N}),T.jsx("ambientLight",{intensity:(1-n)*.9}),T.jsx("directionalLight",{intensity:.7,position:[2,10,0],color:[1,.9,.9]}),T.jsx(nn,{files:[O("/shanghai_bund_4k.hdr")],backgroundRotation:[0,3.3,0],environmentRotation:[0,3.3,0],background:!0,environmentIntensity:.12*n,backgroundIntensity:.08*n}),T.jsx(ar,{intensity:.05*n}),T.jsx(Qn,{isActive:A,origin:[0,10,0]}),T.jsx(Bs,{isActive:y,origin:[0,2,0]}),T.jsx(or,{})]})}),C&&T.jsxs("div",{className:"image-preview-overlay",onClick:()=>N(null),children:[T.jsx("img",{src:C,alt:"Preview",className:"preview-image"}),T.jsx("span",{className:"preview-close-hint",children:"Tap anywhere to close"})]})]})}rn.createRoot(document.getElementById("root")).render(T.jsx(x.StrictMode,{children:T.jsx(cr,{})}));
